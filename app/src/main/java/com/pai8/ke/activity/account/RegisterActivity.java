package com.pai8.ke.activity.account;import android.content.Intent;import android.os.CountDownTimer;import android.text.TextUtils;import android.util.Log;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import com.google.gson.Gson;import com.google.gson.reflect.TypeToken;import com.gyf.immersionbar.ImmersionBar;import com.pai8.ke.R;import com.pai8.ke.activity.common.WebViewActivity;import com.pai8.ke.app.MyApp;import com.pai8.ke.base.BaseActivity;import com.pai8.ke.entity.resp.ResLoginInfo;import com.pai8.ke.global.GlobalConstants;import com.pai8.ke.utils.AppUtils;import com.pai8.ke.utils.NetWorkUtils;import java.io.IOException;import java.util.Map;import java.util.concurrent.ConcurrentSkipListMap;import butterknife.BindView;import butterknife.OnClick;import okhttp3.Call;import okhttp3.Response;public class RegisterActivity extends BaseActivity {    private static final String TAG = "RegisterActivity";    @BindView(R.id.et_user_name)    EditText etUserName;    @BindView(R.id.et_Message)    EditText etMessage;    @BindView(R.id.bt_get_code)    Button btGetCode;    @BindView(R.id.et_pwd)    EditText etPwd;    @BindView(R.id.et_pwdconfirm)    EditText etPwdconfirm;    @BindView(R.id.btn_register)    Button btnRegister;    @BindView(R.id.tv_registerpro)    TextView tvRegisterpro;    private String userPhone;    private String userPwd;    private String userPwdCon;    private String userMessage;    private NetWorkUtils netUtils;    @Override    public int getLayoutId() {        return R.layout.activity_register;    }    @Override    public void initView() {        //透明状态栏，字体深色        ImmersionBar.with(this)                .transparentStatusBar()                .statusBarDarkFont(true)                .init();    }    public void getData() {        userPhone = etUserName.getText().toString().trim();        userPwd = etPwd.getText().toString().trim();        userPwdCon = etPwdconfirm.getText().toString().trim();        userMessage = etMessage.getText().toString().trim();    }    @OnClick({R.id.bt_get_code, R.id.btn_register, R.id.tv_registerpro})    public void onViewClicked(View view) {        getData();        netUtils = NetWorkUtils.getInstance();        switch (view.getId()) {            case R.id.bt_get_code:                if (AppUtils.isPhone(userPhone)) {                    TimeCountDown timeCountDown = new TimeCountDown(120 * 1000, 1000);                    timeCountDown.start();                    Map<String, String> reqBody = new ConcurrentSkipListMap<>();                    reqBody.put("mobile", userPhone);                    netUtils.postDataAsynToNet(MyApp.getHttpBaseUrl() + "public/getCode", reqBody                            , new                                    NetWorkUtils.MyNetCall() {                                        @Override                                        public void success(Call call, Response response) throws IOException {                                            Log.d(TAG, "success: " + response.body().string());                                        }                                        @Override                                        public void failed(Call call, IOException e) {                                            toast(e.getMessage());                                        }                                    });                } else {                    toast("请输入正确的手机号");                }                break;            case R.id.btn_register:                if (!AppUtils.isPhone(userPhone)) {                    toast("请输入正确的手机号");                    return;                } else if (TextUtils.isEmpty(userMessage)) {                    toast("验证码不能为空");                    return;                } else if (TextUtils.isEmpty(userPwd) || userPwd.length() < 6) {                    toast("密码至少6位以上");                    return;                } else if (!userPwdCon.equals(userPwd)) {                    toast("两次输入的密码不一致");                    return;                } else {                    Map<String, String> reqBody = new ConcurrentSkipListMap<>();                    reqBody.put("mobile", userPhone);                    reqBody.put("code", userMessage);                    reqBody.put("pwd", userPwd);                    reqBody.put("repwd", userPwdCon);                    netUtils.postDataAsynToNet(MyApp.getHttpBaseUrl() + "public/register", reqBody,                            new NetWorkUtils.MyNetCall() {                                @Override                                public void success(Call call, Response response) throws IOException {                                    ResLoginInfo loginInfo =                                            new Gson().fromJson(response.body().string(),                                                    new TypeToken<ResLoginInfo>() {                                                    }.getType());                                    int code = loginInfo.getCode();                                    runOnUiThread(new Runnable() {                                        @Override                                        public void run() {                                            if (code == 0) {                                                toast(loginInfo.getMsg());                                            } else if (code == 1) {                                                toast("注册成功");                                                Intent data = new Intent(RegisterActivity.this,                                                        LoginActivity.class);                                                data.putExtra("userPhone", userPhone);                                                setResult(RESULT_OK, data);                                                RegisterActivity.this.finish();                                            }                                        }                                    });                                }                                @Override                                public void failed(Call call, IOException e) {                                    toast(e.getMessage());                                }                            });                }                break;            case R.id.tv_registerpro:                // 注册协议                WebViewActivity.launch(this, "http://test.5pai8.com/agreement/serverProtocol/index.html",                        "注册协议");                break;        }    }    public class TimeCountDown extends CountDownTimer {        public TimeCountDown(long millisInFuture, long countDownInterval) {            super(millisInFuture, countDownInterval);        }        @Override        public void onTick(long millisUntilFinished) {            btGetCode.setClickable(false);            btGetCode.setText(millisUntilFinished / 1000 + "s后重新发送");        }        @Override        public void onFinish() {            btGetCode.setText("获取验证码");            btGetCode.setClickable(true);        }    }}